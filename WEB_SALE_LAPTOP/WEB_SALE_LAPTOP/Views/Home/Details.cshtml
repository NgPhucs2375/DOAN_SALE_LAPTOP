
@model WEB_SALE_LAPTOP.Models.LAPTOP
@{
    ViewBag.Title = Model.TENLAPTOP;
    // Lấy danh sách ảnh từ ViewBag
    var images = ViewBag.ProductImages as List<string> ?? new List<string>();
    // Đường dẫn tới thư mục chứa ảnh. Sửa lại nếu cần.
    string imagePathPrefix = "/Content/images/";
}

<style>
    .product-details-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        margin: 20px auto;
        max-width: 1200px;
        font-family: Arial, sans-serif;
    }

    /* 1. Cột bên trái (Thư viện ảnh) */
    .product-gallery {
        flex: 1;
        min-width: 300px;
        max-width: 500px;
    }

    .main-image-wrapper {
        border: 1px solid #eee;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 15px;
    }

    #main-product-image {
        width: 100%;
        height: auto;
        display: block;
        aspect-ratio: 1 / 1; /* Giữ ảnh vuông vắn */
        object-fit: contain;
    }

    .thumbnail-list {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    .thumbnail {
        width: 80px;
        height: 80px;
        border: 2px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        object-fit: cover;
        transition: border-color 0.3s;
    }

        .thumbnail:hover {
            border-color: #007bff;
        }

        .thumbnail.active {
            border-color: #c00; /* Màu viền cho ảnh đang được chọn */
        }

    /* 2. Cột bên phải (Thông tin sản phẩm) */
    .product-info {
        flex: 1.5;
        min-width: 320px;
    }

        .product-info h1 {
            font-size: 26px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 10px;
        }

    .product-brand {
        font-size: 14px;
        color: #555;
        margin-bottom: 20px;
    }

    /* Giá sản phẩm (giống hình mẫu) */
    .price-section {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .price-new {
        font-size: 32px;
        font-weight: bold;
        color: #d70018; /* Màu đỏ */
        margin-right: 15px;
    }

    .price-old {
        font-size: 20px;
        color: #777;
        text-decoration: line-through;
        margin-right: 10px;
    }

    .discount-badge {
        font-size: 16px;
        font-weight: bold;
        color: #d70018;
        background-color: #fff0f1;
        border: 1px solid #d70018;
        padding: 5px 10px;
        border-radius: 4px;
    }

    /* Quà tặng & Bảo hành (giống hình mẫu) */
    .gift-section, .policy-section {
        margin-bottom: 20px;
        border: 1px dashed #ddd;
        padding: 15px;
        border-radius: 8px;
    }

        .gift-section h4 {
            margin-top: 0;
            color: #d70018;
        }

        .gift-section ul, .policy-section ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .gift-section li, .policy-section li {
            margin-bottom: 8px;
            color: #333;
        }

            .gift-section li::before {
                content: "🎁"; /* Emoji quà */
                margin-right: 10px;
            }

            .policy-section li::before {
                content: "✔"; /* Dấu tick */
                color: green;
                margin-right: 10px;
            }


    /* Nút bấm */
    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 25px;
    }

    .btn-buy-now, .btn-consult {
        flex: 1;
        padding: 15px 20px;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        text-decoration: none;
        border-radius: 8px;
        border: none;
        cursor: pointer;
    }

    .btn-buy-now {
        background-color: #d70018;
        color: white;
    }

    .btn-consult {
        background-color: #fff;
        color: #007bff;
        border: 2px solid #007bff;
    }

    /* 3. Phần mô tả & cấu hình bên dưới */
    .product-description-tabs {
        flex-basis: 100%; /* Chiếm toàn bộ chiều rộng (xuống dòng) */
        margin-top: 30px;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

        .product-description-tabs h3 {
            font-size: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
            display: inline-block;
            margin-top: 0;
        }

    .config-table {
        width: 100%;
        max-width: 800px;
        border-collapse: collapse;
    }

        .config-table td {
            padding: 10px;
            border: 1px solid #eee;
        }

        .config-table tr:nth-child(odd) {
            background-color: #f9f9f9;
        }

        .config-table td:first-child {
            font-weight: 600;
            width: 30%;
        }

    .related-products-section {
        max-width: 1200px;
        margin: 40px auto;
        font-family: Arial, sans-serif;
    }

        .related-products-section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

    /* Lưới hiển thị sản phẩm */
    .product-grid {
        display: grid;
        /* Hiển thị 5 cột trên màn lớn, 3 trên tablet, 2 trên mobile */
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
    }

    /* CSS cho mỗi thẻ sản phẩm */
    .product-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        text-decoration: none;
        color: #333;
        background-color: #fff;
        transition: box-shadow 0.3s ease, transform 0.3s ease;
        display: flex;
        flex-direction: column; /* Đảm bảo nội dung giãn đều */
    }

        .product-card:hover {
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            transform: translateY(-5px);
        }

    .product-card-image {
        width: 100%;
        height: 200px; /* Cố định chiều cao */
        object-fit: contain; /* Hiển thị toàn bộ ảnh */
        padding: 10px;
        background-color: #fdfdfd;
    }

    .product-card-content {
        padding: 15px;
        flex-grow: 1; /* Đẩy phần giá xuống dưới */
        display: flex;
        flex-direction: column;
    }

    .product-card-name {
        font-size: 15px;
        font-weight: 600;
        margin: 0 0 10px 0;
        /* Giới hạn tên sản phẩm trên 2 dòng */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 45px; /* (15px * 1.5 line-height) * 2 = 45px (ước lượng) */
    }

    .product-card-price {
        margin-top: auto; /* Đẩy giá xuống cuối card */
    }

    .product-card-price-new {
        font-size: 18px;
        font-weight: bold;
        color: #d70018; /* Màu đỏ */
    }

    .product-card-price-old {
        font-size: 13px;
        color: #777;
        text-decoration: line-through;
        margin-left: 8px;
    }
</style>

<div class="product-details-container">

    <div class="product-gallery">
        <div class="main-image-wrapper">
            <img id="main-product-image"
                 src="@Url.Content(imagePathPrefix + (images.Count > 0 ? images[0] : "default-image.png"))"
                 alt="@Model.TENLAPTOP">
        </div>

        @if (images.Count > 1)
        {
            <div class="thumbnail-list">
                @foreach (var img in images)
                {
                    <img class="thumbnail"
                         src="@Url.Content(imagePathPrefix + img)"
                         alt="Thumbnail @Model.TENLAPTOP"
                         onclick="changeMainImage(this)">
                }
            </div>
        }
    </div>

    <div class="product-info">

        <h1>@Model.TENLAPTOP</h1>
        <div class="product-brand">
            Thương hiệu: <strong>@(Model.HANG != null ? Model.HANG.TENHANG : "Đang cập nhật")</strong>
        </div>

        <div class="price-section">
            <span class="price-new">@Model.GIA_BAN.ToString("N0")đ</span>

            @if (Model.GIA_GOC > Model.GIA_BAN)
            {
                <span class="price-old">@Model.GIA_GOC.ToString("N0")đ</span>

                var discount = Math.Round(((Model.GIA_GOC - Model.GIA_BAN) / Model.GIA_GOC) * 100);
                <span class="discount-badge"> -@discount% </span>
            }
        </div>

        <div class="gift-section">
            <h4>🎁 Quà tặng</h4>
            <ul>
                <li>MSI Gaming Mouse (kèm máy)</li>
                <li>MSI Dual Drive 256GB (kèm máy)</li>
                <li>MSI Lucky Figure Chain (kèm máy)</li>
                <li>Titan Gaming Backpack (kèm máy)</li>
            </ul>
        </div>

        <div class="policy-section">
            <ul>
                <li>Bảo hành chính hãng 36 tháng.</li>
                <li>Hỗ trợ đổi mới trong 7 ngày.</li>
                <li>Miễn phí giao hàng toàn quốc.</li>
            </ul>
        </div>

        <div class="action-buttons">
            <a href="#" class="btn-buy-now">
                MUA NGAY
                <br>
                <span style="font-size: 12px; font-weight: normal;">Giao tận nơi/Nhận tại cửa hàng</span>
            </a>
            <a href="#" class="btn-consult">
                TƯ VẤN NGAY
                <br>
                <span style="font-size: 12px; font-weight: normal;">Chọn laptop "hợp gu" trong 1 phút!</span>
            </a>
        </div>
    </div>

    <div class="product-description-tabs">

        <div class="product-section">
            <h3>Cấu hình chi tiết</h3>
            <table class="config-table">
                <tr>
                    <td>Cấu hình</td>
                    <td>@Model.CAUHINH</td>
                </tr>
                <tr>
                    <td>Mô tả chung</td>
                    <td>@Model.MOTA</td>
                </tr>

            </table>
        </div>

        <div class="product-section" style="margin-top: 30px;">
            <h3>Mô tả sản phẩm</h3>
            <div>
                @Html.Raw(Model.MOTA)

                @* <pre style="font-family: Arial; white-space: pre-wrap;">@Model.MOTA</pre> *@
            </div>
        </div>

    </div>

</div>


<div class="related-products-section">

    @{
        // Lấy danh sách từ ViewBag
        var sameBrandProducts = ViewBag.SameBrandProducts as List<WEB_SALE_LAPTOP.Models.LAPTOP>;
        
    }

    @if (sameBrandProducts != null && sameBrandProducts.Count > 0)
    {
        <h2>Sản phẩm cùng hãng @(Model.HANG != null ? Model.HANG.TENHANG : "")</h2>

        <div class="product-grid">
            @foreach (var item in sameBrandProducts)
            {
                <a href="@Url.Action("Details", "Product", new { id = item.MALAPTOP })" class="product-card">

                    <img src="@Url.Content(imagePathPrefix + (item.HINHANH0 ?? "default-image.png"))"
                         alt="@item.TENLAPTOP"
                         class="product-card-image">

                    <div class="product-card-content">
                        <h3 class="product-card-name">@item.TENLAPTOP</h3>

                        <div class="product-card-price">
                            <span class="product-card-price-new">@item.GIA_BAN.ToString("N0")đ</span>

                            @if (item.GIA_GOC > item.GIA_BAN)
                            {
                                <span class="product-card-price-old">@item.GIA_GOC.ToString("N0")đ</span>
                            }
                        </div>
                    </div>
                </a>
            }
        </div>
    }

    @{
        var sameTypeProducts = ViewBag.SameTypeProducts as List<WEB_SALE_LAPTOP.Models.LAPTOP>;
    }

    @if (sameTypeProducts != null && sameTypeProducts.Count > 0)
    {
        <h2 style="margin-top: 50px;">
            Sản phẩm cùng loại @(Model.LOAI_LAPTOP != null ? Model.LOAI_LAPTOP.TENLOAI : "")
        </h2>

        <div class="product-grid">
            @foreach (var item in sameTypeProducts)
            {
                <a href="@Url.Action("Details", "Product", new { id = item.MALAPTOP })" class="product-card">

                    <img src="@Url.Content(imagePathPrefix + (item.HINHANH0 ?? "default-image.png"))"
                         alt="@item.TENLAPTOP"
                         class="product-card-image">

                    <div class="product-card-content">
                        <h3 class="product-card-name">@item.TENLAPTOP</h3>

                        <div class="product-card-price">
                            <span class="product-card-price-new">@item.GIA_BAN.ToString("N0")đ</span>

                            @if (item.GIA_GOC > item.GIA_BAN)
                            {
                                <span class="product-card-price-old">@item.GIA_GOC.ToString("N0")đ</span>
                            }
                        </div>
                    </div>
                </a>
            }
        </div>
    }

</div>

<script>
    // Lấy tất cả ảnh thumbnail
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage = document.getElementById('main-product-image');

    // Đặt viền 'active' cho ảnh đầu tiên khi tải trang
    if (thumbnails.length > 0) {
        thumbnails[0].classList.add('active');
    }

    // Hàm đổi ảnh chính
    function changeMainImage(thumbnailElement) {
        // Lấy src của thumbnail được click
        const newImageSrc = thumbnailElement.src;

        // Gán src đó cho ảnh lớn
        mainImage.src = newImageSrc;

        // Xóa class 'active' khỏi tất cả thumbnail
        thumbnails.forEach(thumb => {
            thumb.classList.remove('active');
        });

        // Thêm class 'active' cho thumbnail vừa được click
        thumbnailElement.classList.add('active');
    }
</script>