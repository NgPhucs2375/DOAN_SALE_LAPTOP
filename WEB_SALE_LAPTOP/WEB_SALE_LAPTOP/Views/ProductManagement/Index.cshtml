@model WEB_SALE_LAPTOP.Models.ProductManagementViewModel
@using PagedList.Mvc;

@{
    ViewBag.Title = "Quản lý Sản phẩm (Pro)";
}

<div class="stat-card-grid" style="grid-template-columns: repeat(3, 1fr);">

    <div class="stat-card total">
        <div class="stat-icon icon-total"><i class="fa-solid fa-box-archive"></i></div>
        <div class="stat-info">
            <span class="stat-title">Tổng số Sản phẩm</span>
            <span class="stat-value">@Model.TongSoSanPham</span>
        </div>
    </div>

    <div class="stat-card active-sale">
        <div class="stat-icon icon-revenue"><i class="fa-solid fa-check-circle"></i></div>
        <div class="stat-info">
            <span class="stat-title">Đang bán</span>
            <span class="stat-value">@Model.SanPhamDangBan</span>
        </div>
    </div>

    <div class="stat-card inactive-stock">
        <div class="stat-icon icon-pending"><i class="fa-solid fa-eye-slash"></i></div>
        <div class="stat-info">
            <span class="stat-title">Đã ẩn / Hết hàng</span>
            <span class="stat-value">@Model.SanPhamDaAn</span>
        </div>
    </div>
</div>

<div class="page-header" style="margin-top: 2rem;">
    <h2 class="section-title">Danh sách Sản phẩm</h2>
    <a href="@Url.Action("Create")" class="btn-primary-admin" style="text-decoration: none;">
        <i class="fa-solid fa-plus"></i>
        <span>Thêm Mới</span>
    </a>
</div>

@using (Html.BeginForm("Index", "ProductManagement", FormMethod.Get, new { @class = "admin-filter-bar" }))
{
    <div class="filter-group">
        <i class="fa-solid fa-search"></i>
        @Html.TextBox("search", Model.CurrentSearch, new { @class = "filter-input", placeholder = "Tìm theo tên, cấu hình..." })
    </div>

    <div class="filter-group">
        <i class="fa-solid fa-tag"></i>
        @Html.DropDownList("brandId", Model.Brands, new { @class = "filter-select" })
    </div>

    <div class="filter-group">
        <i class="fa-solid fa-list"></i>
        @Html.DropDownList("categoryId", Model.Categories, new { @class = "filter-select" })
    </div>

    <button type="submit" class="btn-primary-admin filter-submit-btn">
        <i class="fa-solid fa-filter"></i> Lọc
    </button>
}

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Sản Phẩm</th>
                <th>Hãng</th>
                <th>Loại</th>
                <th>Giá Bán</th>
                <th>Tồn kho</th>
                <th>Trạng thái</th>
                <th style="text-align: right;"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Products)
            {
                <tr>
                    <td class="product-info-cell">
                        <img src="~/Content/images/@item.HINHANH0" alt="@item.TENLAPTOP" class="table-product-img" />
                        <div class="product-info-text">
                            <strong>@Html.DisplayFor(modelItem => item.TENLAPTOP)</strong>
                            <small>ID: @item.MALAPTOP</small>
                        </div>
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.HANG.TENHANG)</td>
                    <td>@Html.DisplayFor(modelItem => item.LOAI_LAPTOP.TENLOAI)</td>

                    <td style="color: var(--primary-color); font-weight: bold; font-size: 1.1rem;">
                        @String.Format("{0:N0}", item.GIA_BAN) ₫
                    </td>

                    <td style="font-weight: 700;">
                        <span class="stock-qty-badge @(item.SOLUONG_TON < 5 ? "low-stock" : "")">
                            @Html.DisplayFor(modelItem => item.SOLUONG_TON)
                        </span>
                    </td>

                    <td>
                        @if (item.TRANGTHAI == true)
                        {
                            <span class="status status-active">Đang bán</span>
                        }
                        else
                        {
                            <span class="status status-inactive">Đã ẩn</span>
                        }
                    </td>

                    <td class="action-buttons">
                        <a href="@Url.Action("Edit", new { id=item.MALAPTOP })" class="btn-action btn-edit" title="Sửa">
                            <i class="fa-solid fa-pencil"></i>
                        </a>
                        <a href="@Url.Action("Delete", new { id=item.MALAPTOP })" class="btn-action btn-delete" title="Xóa">
                            <i class="fa-solid fa-trash"></i>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="pagination-container">
    @Html.PagedListPager(Model.Products, page => Url.Action("Index",
        new
            {
                page,
            search = Model.CurrentSearch,
            brandId = Model.CurrentBrandId,
            categoryId = Model.CurrentCategoryId
        }),
        new PagedListRenderOptions
        {
            // Set Class chung cho thẻ UL
            UlElementClasses = new[] { "pagination" },
            // Set Class cho thẻ LI
            LiElementClasses = new[] { "page-item" },
            // SỬA LỖI: Không cần đặt PageClasses vì style CSS đã xử lý link bên trong LI

            DisplayLinkToFirstPage = PagedListDisplayMode.IfNeeded,
            DisplayLinkToLastPage = PagedListDisplayMode.IfNeeded,
            DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
            DisplayLinkToNextPage = PagedListDisplayMode.Always,
            EllipsesFormat = "...",
            LinkToFirstPageFormat = "« Đầu",
            LinkToPreviousPageFormat = "‹ Trước",
            LinkToNextPageFormat = "Sau ›",
            LinkToLastPageFormat = "Cuối »"
        })
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            var currentBrand = '@Model.CurrentBrandId';
            if (currentBrand && currentBrand !== '0') {
                $('#brandId').val(currentBrand);
            }
            var currentCategory = '@Model.CurrentCategoryId';
            if (currentCategory && currentCategory !== '0') {
                $('#categoryId').val(currentCategory);
            }
        });
    </script>
}