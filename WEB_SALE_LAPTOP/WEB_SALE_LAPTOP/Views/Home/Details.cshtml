@model WEB_SALE_LAPTOP.Models.LAPTOP
@{
    ViewBag.Title = Model.TENLAPTOP;
    Layout = "~/Views/Shared/_Layout.cshtml"; // (Đã dùng Layout "tiến hóa")

    // Lấy danh sách ảnh từ ViewBag (Code cũ đã tốt)
    var images = ViewBag.ProductImages as List<string> ?? new List<string>();
    string imagePathPrefix = "/Content/images/";

    // Lấy sản phẩm liên quan (Code cũ đã tốt)
    var sameBrandProducts = ViewBag.SameBrandProducts as List<WEB_SALE_LAPTOP.Models.LAPTOP>;
    var sameTypeProducts = ViewBag.SameTypeProducts as List<WEB_SALE_LAPTOP.Models.LAPTOP>;
}

<div class="product-section">
    <div class="contact-page-wrapper">

        <div class="product-gallery">
            <div class="main-image-wrapper">
                <img id="main-product-image"
                     src="@Url.Content(imagePathPrefix + (images.Count > 0 ? images[0] : "default.png"))"
                     alt="@Model.TENLAPTOP">
            </div>

            @if (images.Count > 1)
            {
                <div class="thumbnail-list">
                    @foreach (var img in images)
                    {
                        <img class="thumbnail"
                             src="@Url.Content(imagePathPrefix + img)"
                             alt="Thumbnail @Model.TENLAPTOP">
                    }
                </div>
            }
        </div>

        <div class="product-info">

            <h1 class="section-title" style="border: none; padding: 0; margin-bottom: 0.5rem;">
                @Model.TENLAPTOP
            </h1>

            <div class="product-brand">
                Thương hiệu: <strong>@(Model.HANG != null ? Model.HANG.TENHANG : "...")</strong>
                | Loại: <strong>@(Model.LOAI_LAPTOP != null ? Model.LOAI_LAPTOP.TENLOAI : "...")</strong>
            </div>

            <div class="card-price" style="margin-top: 1.5rem;">
                <span class="price-new" style="font-size: 2.5rem;">@Model.GIA_BAN.ToString("N0") ₫</span>

                @if (Model.GIA_GOC > Model.GIA_BAN)
                {
                    <span class="price-old" style="font-size: 1.5rem;">@Model.GIA_GOC.ToString("N0") ₫</span>
                }
            </div>

            <div class="sidebar-promo-card" style="margin-top: 1.5rem; background: var(--bg-main);">
                <div class="promo-badge">Quà tặng</div>
                <h4 class="promo-title" style="color: var(--color-primary);">Ưu đãi đi kèm</h4>
                <p class="promo-desc" style="color: var(--text-dark);">
                    (Nội dung quà tặng tĩnh) <br />
                    - Balo Laptop Pro cao cấp <br />
                    - Chuột không dây "Cổ điển" <br />
                    - Gói cài đặt phần mềm miễn phí 1 năm.
                </p>
            </div>

            @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post))
            {
                @Html.Hidden("maLaptop", Model.MALAPTOP)
                @Html.Hidden("soLuong", 1) <div class="card-actions" style="margin-top: 1.5rem;">

                    <button type="submit" class="btn-add-cart" style="height: 50px; font-size: 1rem;">
                        <i class="fa-solid fa-cart-plus"></i> THÊM VÀO GIỎ
                    </button>

                    <a href="@Url.Action("Contact", "Home")" class="btn-primary-admin" style="height: 50px; text-decoration: none; justify-content: center; font-size: 1rem;">
                        TƯ VẤN NGAY
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<div class="product-section" style="margin-top: 2rem;">
    <h2 class="section-title">Thông tin chi tiết</h2>

    <table class="config-table-pro">
        <tr>
            <td><i class="fa-solid fa-tags"></i> Tên sản phẩm</td>
            <td>@Model.TENLAPTOP</td>
        </tr>

        @if (!string.IsNullOrEmpty(Model.CAUHINH))
        {
            var specs = Model.CAUHINH.Split(',');
            foreach (var spec in specs)
            {
                <tr>
                    <td>
                        @if (spec.ToLower().Contains("cpu") || spec.ToLower().Contains("core") || spec.ToLower().Contains("ryzen"))
                        {<i class="fa-solid fa-microchip"></i> }
                        else if (spec.ToLower().Contains("ram"))
                        { <i class="fa-solid fa-memory"></i> }
                        else if (spec.ToLower().Contains("ssd") || spec.ToLower().Contains("hdd"))
                        { <i class="fa-solid fa-hard-drive"></i> }
                        else
                        { <i class="fa-solid fa-laptop-file"></i>}

                        @spec.Split(':')[0].Trim()
                    </td>
                    <td>
                        @if (spec.Contains(":"))
                        {@spec.Split(':')[1].Trim() }
                    else
                    { @spec.Trim()}
                    </td>
                </tr>
            }
        }

        <tr>
            <td><i class="fa-solid fa-file-lines"></i> Mô tả chung</td>
            <td>@Model.MOTA</td>
        </tr>
    </table>
</div>

<div class="related-products-section">

    @if (sameBrandProducts != null && sameBrandProducts.Count > 0)
    {
        <h2 class="section-title">Sản phẩm cùng hãng @(Model.HANG != null ? Model.HANG.TENHANG : "")</h2>

        <div class="card-container">
            @foreach (var item in sameBrandProducts)
            {
                <a href="@Url.Action("Details", "Home", new { id = item.MALAPTOP })" class="card">
                    @if (item.GIA_BAN < item.GIA_GOC)
                    {<div class="card-badge">Giảm giá</div>}
                    <div class="card-img-container">
                        <img src="@Url.Content(imagePathPrefix + (item.HINHANH0 ?? "default.png"))" class="card-img">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">@item.TENLAPTOP</h3>
                        <div class="card-price">
                            <span class="price-new">@item.GIA_BAN.ToString("N0") ₫</span>
                            @if (item.GIA_GOC > item.GIA_BAN)
                            {
                                <span class="price-old">@item.GIA_GOC.ToString("N0") ₫</span>
                            }
                        </div>
                    </div>
                </a>
            }
        </div>
    }

    @if (sameTypeProducts != null && sameTypeProducts.Count > 0)
    {
        <h2 class="section-title" style="margin-top: 2rem;">
            Sản phẩm cùng loại @(Model.LOAI_LAPTOP != null ? Model.LOAI_LAPTOP.TENLOAI : "")
        </h2>

        <div class="card-container">
            @foreach (var item in sameTypeProducts)
            {
                <a href="@Url.Action("Details", "Home", new { id = item.MALAPTOP })" class="card">
                    @if (item.GIA_BAN < item.GIA_GOC)
                    {<div class="card-badge">Giảm giá</div>}
                    <div class="card-img-container">
                        <img src="@Url.Content(imagePathPrefix + (item.HINHANH0 ?? "default.png"))" class="card-img">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">@item.TENLAPTOP</h3>
                        <div class="card-price">
                            <span class="price-new">@item.GIA_BAN.ToString("N0") ₫</span>
                            @if (item.GIA_GOC > item.GIA_BAN)
                            {
                                <span class="price-old">@item.GIA_GOC.ToString("N0") ₫</span>
                            }
                        </div>
                    </div>
                </a>
            }
        </div>
    }
</div>

@section scripts {
    <script>
        // Dùng $(document).ready() (chuẩn "pro")
        $(document).ready(function () {

            // Lấy tất cả ảnh thumbnail
            const $thumbnails = $('.thumbnail');
            const $mainImage = $('#main-product-image');

            // Đặt viền 'active' cho ảnh đầu tiên khi tải trang
            if ($thumbnails.length > 0) {
                $thumbnails.first().addClass('active');
            }

            // Hàm đổi ảnh chính (đã "tiến hóa")
            $thumbnails.on('click', function () {
                // Lấy src của thumbnail được click
                const newImageSrc = $(this).attr('src');

                // Gán src đó cho ảnh lớn
                $mainImage.attr('src', newImageSrc);

                // Xóa class 'active' khỏi tất cả
                $thumbnails.removeClass('active');

                // Thêm class 'active' cho ảnh vừa click
                $(this).addClass('active');
            });
        });
    </script>
}